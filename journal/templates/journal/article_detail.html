{% extends 'journal/base.html' %}

{% block title %}{{ article.title }} - Цифровая редакция{% endblock %}

{% block content %}
<article class="article">
    <h1>{{ article.title }}</h1>
    
    <div class="article-meta">
        <p><strong>Автор:</strong> {{ article.author.get_full_name|default:article.author.username }}</p>
        <p><strong>Рубрика:</strong> {{ article.category.name|default:"Без рубрики" }}</p>
        <p><strong>Статус:</strong> {{ article.get_status_display }}</p>
        <p><strong>Создана:</strong> {{ article.created_at|date:"d.m.Y H:i" }}</p>
        <p><strong>Обновлена:</strong> {{ article.updated_at|date:"d.m.Y H:i" }}</p>
    </div>
    
    <div class="article-content">
        {{ article.content|linebreaks }}
    </div>

    {% if user.is_editor or article.author == user %}
    <div class="article-actions">
        <a href="{% url 'edit_article' article.id %}">Редактировать</a>
        
        {% if user.is_editor %}
        <div class="status-actions">
            <strong>Изменить статус:</strong>
            {% for status_value, status_name in article.STATUS_CHOICES %}
                {% if status_value != article.status %}
                    <a href="{% url 'change_article_status' article.id status_value %}">{{ status_name }}</a>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}
</article>

<div class="comments-section">
    <h2>Комментарии</h2>
    
    {% for comment in article.comment_set.all %}
    <div class="comment">
        <p><strong>{{ comment.author.username }}</strong> ({{ comment.created_at|date:"d.m.Y H:i" }}):</p>
        <p>{{ comment.text }}</p>
        {% if comment.target_text %}
        <blockquote>{{ comment.target_text }}</blockquote>
        {% endif %}
    </div>
    {% empty %}
    <p>Пока нет комментариев.</p>
    {% endfor %}
    
    {% if user.is_authenticated %}
    <div class="add-comment">
        <a href="{% url 'add_comment' article.id %}">Добавить комментарий</a>
    </div>
    {% endif %}
</div>

<a href="{% url 'dashboard' %}">Вернуться в личный кабинет</a>
{% endblock %}